import newclay.parser.*;
import newclay.ast.*;
import newclay.lexer.*;
import maybe.*;
import externals.*;

private impl_parse(tokens:SourceTokens) {
    var input = ParserInput(tokens);
    var ast = parse2(input);
    if (nothing?(ast))
        throw ParserError(tokens, input.maxCurrent);
    var ast2 = require(move(ast));
    ast2.tokens = tokens;

    return move(ast2);
}

external parser_parse(
    ex:ExternalException,
    inTokens:Pointer[SourceTokens],
    out:Pointer[SourceAST]
) {
    wrapAsExternal(impl_parse, static 1, ex, inTokens, out);
}
