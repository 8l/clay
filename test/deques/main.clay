import deques.*;

var canaryCounter = 0u;
record Canary { id: UInt; }
_Canary(r: Canary) { r.id <-- canaryCounter; inc(canaryCounter); }
overload Canary() r:Canary { _Canary(r); println("-- constructed ", r.id); }
overload Canary(x: Canary) r:Canary { _Canary(r); println("-- copied ", x.id, " to ", r.id); }
overload destroy(x: Canary) { println("-- deleted ", x.id); }
overload moveUnsafe(x: Canary) r:Canary { _Canary(r); println("-- moved ", x.id, " to ", r.id); }
overload assign(x: Canary, y: Canary) { }

main() {
    var d1 = Deque[Int]();
    alias TEST_RANGE = 500;

    for (i in range(TEST_RANGE)) {
        pushFront(d1, 2*i);
        push(d1, 2*i + 1);
    }

    println("Full size ", size(d1));

    println("Iterating:");
    
    var n = 0;
    for (x in d1) {
        print(x, " ");
        n += 1;
        if (n == 20) {
            println();
            n = 0;
        }
    }
    println();

    println("d1[0] = ", d1[0]);
    println("d1[999] = ", d1[999]);
    println("d1[500] = ", d1[500]);

    d1[500] = 1111;

    println("now d1[500] = ", d1[500]);

    println("Popping:");

    n = 0;
    for (i in range(TEST_RANGE)) {
        var x = popFront(d1);
        var y = pop(d1);

        print(y, " ", x, " ");
        n += 2;
        if (n == 20) {
            println();
            n = 0;
        }
    }

    println("Empty size ", size(d1));
}
